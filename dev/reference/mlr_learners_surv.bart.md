# Survival Bayesian Additive Regression Trees Learner

Fits a Bayesian Additive Regression Trees (BART) learner to
right-censored survival data. Calls
[`BART::mc.surv.bart()`](https://rdrr.io/pkg/BART/man/surv.bart.html)
from [BART](https://CRAN.R-project.org/package=BART).

## Prediction types

This learner returns two prediction types:

1.  `distr`: a 3d survival array with observations as 1st dimension,
    time points as 2nd and the posterior draws as 3rd dimension.
    Calculated using the internal `predict.survbart()` function.

2.  `crank`: the expected mortality using
    [`mlr3proba::surv_return()`](https://mlr3proba.mlr-org.com/reference/surv_return.html).
    The parameter `which.curve` decides which posterior draw (3rd
    dimension) will be used for the calculation of the expected
    mortality. Note that the median posterior is by default used for the
    calculation of survival measures that require a `distr` prediction,
    see more info on
    [PredictionSurv](https://mlr3proba.mlr-org.com/reference/PredictionSurv.html).

## Initial parameter values

- `mc.cores` is initialized to 1 to avoid threading conflicts with
  [future](https://CRAN.R-project.org/package=future).

## Custom mlr3 parameters

- `quiet` allows to suppress messages generated by the wrapped C++ code.
  Is initialized to `TRUE`.

- `importance` allows to choose the type of importance. Default is
  `count`, see documentation of method `$importance()` for more details.

- `which.curve` allows to choose which posterior draw will be used for
  the calculation of the `crank` prediction. If between (0,1) it is
  taken as the quantile of the curves otherwise if greater than 1 it is
  taken as the curve index, can also be 'mean'. By default the **median
  posterior** is used, i.e. `which.curve` is 0.5.

## Dictionary

This [Learner](https://mlr3.mlr-org.com/reference/Learner.html) can be
instantiated via
[lrn()](https://mlr3.mlr-org.com/reference/mlr_sugar.html):

    lrn("surv.bart")

## Meta Information

- Task type: “surv”

- Predict Types: “crank”, “distr”

- Feature Types: “logical”, “integer”, “numeric”

- Required Packages: [mlr3](https://CRAN.R-project.org/package=mlr3),
  [mlr3proba](https://CRAN.R-project.org/package=mlr3proba),
  [BART](https://CRAN.R-project.org/package=BART)

## Parameters

|             |           |         |              |                       |
|-------------|-----------|---------|--------------|-----------------------|
| Id          | Type      | Default | Levels       | Range                 |
| K           | numeric   | NULL    |              | \\\[1, \infty)\\      |
| events      | untyped   | NULL    |              | \-                    |
| ztimes      | untyped   | NULL    |              | \-                    |
| zdelta      | untyped   | NULL    |              | \-                    |
| sparse      | logical   | FALSE   | TRUE, FALSE  | \-                    |
| theta       | numeric   | 0       |              | \\(-\infty, \infty)\\ |
| omega       | numeric   | 1       |              | \\(-\infty, \infty)\\ |
| a           | numeric   | 0.5     |              | \\\[0.5, 1\]\\        |
| b           | numeric   | 1       |              | \\(-\infty, \infty)\\ |
| augment     | logical   | FALSE   | TRUE, FALSE  | \-                    |
| rho         | numeric   | NULL    |              | \\(-\infty, \infty)\\ |
| usequants   | logical   | FALSE   | TRUE, FALSE  | \-                    |
| rm.const    | logical   | TRUE    | TRUE, FALSE  | \-                    |
| type        | character | pbart   | pbart, lbart | \-                    |
| ntype       | integer   | \-      |              | \\\[1, 3\]\\          |
| k           | numeric   | 2       |              | \\\[0, \infty)\\      |
| power       | numeric   | 2       |              | \\\[0, \infty)\\      |
| base        | numeric   | 0.95    |              | \\\[0, 1\]\\          |
| offset      | numeric   | NULL    |              | \\(-\infty, \infty)\\ |
| ntree       | integer   | 50      |              | \\\[1, \infty)\\      |
| numcut      | integer   | 100     |              | \\\[1, \infty)\\      |
| ndpost      | integer   | 1000    |              | \\\[1, \infty)\\      |
| nskip       | integer   | 250     |              | \\\[0, \infty)\\      |
| keepevery   | integer   | 10      |              | \\\[1, \infty)\\      |
| printevery  | integer   | 100     |              | \\\[1, \infty)\\      |
| seed        | integer   | 99      |              | \\(-\infty, \infty)\\ |
| mc.cores    | integer   | 2       |              | \\\[1, \infty)\\      |
| nice        | integer   | 19      |              | \\\[0, 19\]\\         |
| openmp      | logical   | TRUE    | TRUE, FALSE  | \-                    |
| quiet       | logical   | TRUE    | TRUE, FALSE  | \-                    |
| importance  | character | count   | count, prob  | \-                    |
| which.curve | numeric   | \-      |              | \\\[0, \infty)\\      |

## References

Sparapani, Rodney, Spanbauer, Charles, McCulloch, Robert (2021).
“Nonparametric machine learning and efficient computation with bayesian
additive regression trees: the BART R package.” *Journal of Statistical
Software*, **97**, 1–66.

Chipman, A H, George, I E, McCulloch, E R (2010). “BART: Bayesian
additive regression trees.” *The Annals of Applied Statistics*,
**4**(1), 266–298.

## See also

- [Dictionary](https://mlr3misc.mlr-org.com/reference/Dictionary.html)
  of [Learners](https://mlr3.mlr-org.com/reference/Learner.html):
  [mlr3::mlr_learners](https://mlr3.mlr-org.com/reference/mlr_learners.html).

- `as.data.table(mlr_learners)` for a table of available
  [Learners](https://mlr3.mlr-org.com/reference/Learner.html) in the
  running session (depending on the loaded packages).

- Chapter in the [mlr3book](https://mlr3book.mlr-org.com/):
  <https://mlr3book.mlr-org.com/basics.html#learners>

- [mlr3learners](https://CRAN.R-project.org/package=mlr3learners) for a
  selection of recommended learners.

- [mlr3cluster](https://CRAN.R-project.org/package=mlr3cluster) for
  unsupervised clustering learners.

- [mlr3pipelines](https://CRAN.R-project.org/package=mlr3pipelines) to
  combine learners with pre- and postprocessing steps.

- [mlr3tuning](https://CRAN.R-project.org/package=mlr3tuning) for tuning
  of hyperparameters,
  [mlr3tuningspaces](https://CRAN.R-project.org/package=mlr3tuningspaces)
  for established default tuning spaces.

## Author

bblodfon

## Super classes

[`mlr3::Learner`](https://mlr3.mlr-org.com/reference/Learner.html) -\>
[`mlr3proba::LearnerSurv`](https://mlr3proba.mlr-org.com/reference/LearnerSurv.html)
-\> `LearnerSurvLearnerSurvBART`

## Methods

### Public methods

- [`LearnerSurvLearnerSurvBART$new()`](#method-LearnerSurvLearnerSurvBART-new)

- [`LearnerSurvLearnerSurvBART$importance()`](#method-LearnerSurvLearnerSurvBART-importance)

- [`LearnerSurvLearnerSurvBART$clone()`](#method-LearnerSurvLearnerSurvBART-clone)

Inherited methods

- [`mlr3::Learner$base_learner()`](https://mlr3.mlr-org.com/reference/Learner.html#method-base_learner)
- [`mlr3::Learner$configure()`](https://mlr3.mlr-org.com/reference/Learner.html#method-configure)
- [`mlr3::Learner$encapsulate()`](https://mlr3.mlr-org.com/reference/Learner.html#method-encapsulate)
- [`mlr3::Learner$format()`](https://mlr3.mlr-org.com/reference/Learner.html#method-format)
- [`mlr3::Learner$help()`](https://mlr3.mlr-org.com/reference/Learner.html#method-help)
- [`mlr3::Learner$predict()`](https://mlr3.mlr-org.com/reference/Learner.html#method-predict)
- [`mlr3::Learner$predict_newdata()`](https://mlr3.mlr-org.com/reference/Learner.html#method-predict_newdata)
- [`mlr3::Learner$print()`](https://mlr3.mlr-org.com/reference/Learner.html#method-print)
- [`mlr3::Learner$reset()`](https://mlr3.mlr-org.com/reference/Learner.html#method-reset)
- [`mlr3::Learner$selected_features()`](https://mlr3.mlr-org.com/reference/Learner.html#method-selected_features)
- [`mlr3::Learner$train()`](https://mlr3.mlr-org.com/reference/Learner.html#method-train)

------------------------------------------------------------------------

### Method `new()`

Creates a new instance of this
[R6](https://r6.r-lib.org/reference/R6Class.html) class.

#### Usage

    LearnerSurvLearnerSurvBART$new()

------------------------------------------------------------------------

### Method `importance()`

Two types of importance scores are supported based on the value of the
parameter `importance`:

1.  `prob`: The mean selection probability of each feature in the trees,
    extracted from the slot `varprob.mean`. If `sparse = FALSE`
    (default), this is a fixed constant. Recommended to use this option
    when `sparse = TRUE`.

2.  `count`: The mean observed count of each feature in the trees
    (average number of times the feature was used in a tree decision
    rule across all posterior draws), extracted from the slot
    `varcount.mean`. This is the default importance scores.

In both cases, higher values signify more important variables.

#### Usage

    LearnerSurvLearnerSurvBART$importance()

#### Returns

Named [`numeric()`](https://rdrr.io/r/base/numeric.html).

------------------------------------------------------------------------

### Method `clone()`

The objects of this class are cloneable with this method.

#### Usage

    LearnerSurvLearnerSurvBART$clone(deep = FALSE)

#### Arguments

- `deep`:

  Whether to make a deep clone.

## Examples

``` r
lrn("surv.bart")
#> 
#> ── <LearnerSurvLearnerSurvBART> (surv.bart): Bayesian Additive Regression Trees 
#> • Model: -
#> • Parameters: mc.cores=1, quiet=TRUE, importance=count, which.curve=0.5
#> • Packages: mlr3, mlr3proba, and BART
#> • Predict Types: [crank] and distr
#> • Feature Types: logical, integer, and numeric
#> • Encapsulation: none (fallback: -)
#> • Properties: importance and missings
#> • Other settings: use_weights = 'error'
```
