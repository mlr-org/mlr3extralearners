<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mlr3extralearners">
<title>Creating a new Learner • mlr3extralearners</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating a new Learner">
<meta property="og:description" content="mlr3extralearners">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mlr3extralearners</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.8.0-9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa fa fa-file-alt"></span>
     
    Reference
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mlr3book.mlr-org.com">
    <span class="fa fa fa fa-link"></span>
     
    mlr3book
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/list_learners.html">Learner List</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/learner_status.html">Learner Status</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/extending.html">Extending</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlr-org/mlr3extralearners">
    <span class="fa fa fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Creating a new Learner</h1>
            
      
      
      <div class="d-none name"><code>extending.Rmd</code></div>
    </div>

    
    
<p>Many learners are already included in the <code>mlr3</code>
ecosystem, but there are still many more that have not been implemented
and so in this vignette we will look at how to add a new
<code>Learner</code> to <code>mlr3</code>. Here we will already assume a
lot of knowledge, so it is best to read the <a href="https://mlr3book.mlr-org.com/" class="external-link">mlr3book</a> first! If you want to
contribute a new <code>Learner</code> to <code>mlr3extralearners</code>
it is recommended to first open an issue to discuss the learner. As
another side note, the <code>mlr3extralearner::create_learner()</code>
function can be used to generate files containing templates for the
learner and test files required to create and test a
<code>Learner</code>. We will not use it in this vignette for the sake
of clarity, but recommend using it in practice to avoid writing a lot of
boilerplate code.</p>
<p>We will first demonstrate what the final class looks like and then we
will explain it line by line (and method by method). As a working
example, we will implement a slightly stripped-down version of
<code>regr.rpart</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com" class="external-link">paradox</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org" class="external-link">R6</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3misc.mlr-org.com" class="external-link">mlr3misc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">LearnerRegrRpartSimple</span> <span class="op">=</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span><span class="st">"LearnerRegrRpartSimple"</span>,</span>
<span>  inherit <span class="op">=</span> <span class="va">LearnerRegr</span>,</span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">param_set</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span></span>
<span>        cp             <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, default <span class="op">=</span> <span class="fl">0.01</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        maxcompete     <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">0L</span>, default <span class="op">=</span> <span class="fl">4L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        maxdepth       <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">30L</span>, default <span class="op">=</span> <span class="fl">30L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        maxsurrogate   <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">0L</span>, default <span class="op">=</span> <span class="fl">5L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        minbucket      <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">1L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        minsplit       <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">1L</span>, default <span class="op">=</span> <span class="fl">20L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        surrogatestyle <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">1L</span>, default <span class="op">=</span> <span class="fl">0L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        usesurrogate   <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">2L</span>, default <span class="op">=</span> <span class="fl">2L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span>,</span>
<span>        xval           <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int</a></span><span class="op">(</span><span class="fl">0L</span>, default <span class="op">=</span> <span class="fl">10L</span>, tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">xval</span> <span class="op">=</span> <span class="fl">10</span></span>
<span>      <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span></span>
<span>        id <span class="op">=</span> <span class="st">"regr.rpart_simple"</span>,</span>
<span>        feature_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logical"</span>, <span class="st">"integer"</span>, <span class="st">"numeric"</span>, <span class="st">"factor"</span>, <span class="st">"ordered"</span><span class="op">)</span>,</span>
<span>        predict_types <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>        packages <span class="op">=</span> <span class="st">"rpart"</span>,</span>
<span>        param_set <span class="op">=</span> <span class="va">param_set</span>,</span>
<span>        properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weights"</span>, <span class="st">"missings"</span>, <span class="st">"importance"</span><span class="op">)</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"Regression Tree"</span>,</span>
<span>        man <span class="op">=</span> <span class="st">"mlr3::mlr_learners_regr.rpart"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    importance <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/printf.html" class="external-link">stopf</a></span><span class="op">(</span><span class="st">"No model stored"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="co"># importance is only present if there is at least on split</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">variable.importance</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">importance</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">importance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">variable.importance</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    .train <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">task</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pv</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="st">"weights"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">task</span><span class="op">$</span><span class="va">properties</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">pv</span><span class="op">$</span><span class="va">weights</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">weights</span><span class="op">$</span><span class="va">weight</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/invoke.html" class="external-link">invoke</a></span><span class="op">(</span></span>
<span>        <span class="fu">rpart</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span>,</span>
<span>        formula <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">formula</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        .args <span class="op">=</span> <span class="va">pv</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    .predict <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">task</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pv</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"predict"</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># ensure same column order in train and predict</span></span>
<span>      <span class="va">newdata</span> <span class="op">=</span> <span class="fu">mlr3extralearners</span><span class="fu">:::</span><span class="fu">ordered_features</span><span class="op">(</span><span class="va">task</span>, <span class="va">self</span><span class="op">)</span></span>
<span>      <span class="va">response</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="va">predict</span>, <span class="va">self</span><span class="op">$</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, .args <span class="op">=</span> <span class="va">pv</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We first specify the class name according to the <code>mlr3</code>
naming convention as <code>"LearnerRegrRpartSimple"</code>. In the
second line, we select the appropriate parent class from which we want
to inherit. Because we are implementing a regression learner, we have to
inherit from the <code>LearnerRegr</code> class. For classification we
would inherit from <code>LearnerClassif</code>, for survival from
<code><a href="https://mlr3proba.mlr-org.com/reference/LearnerSurv.html" class="external-link">mlr3proba::LearnerSurv</a></code>, and for clustering from
<code><a href="https://mlr3cluster.mlr-org.com/reference/LearnerClust.html" class="external-link">mlr3cluster::LearnerClust</a></code>.</p>
<p>In the constructor, the constructor of the super class (in this case
<code>LearnerRegr</code>) is called with meta-information about the
learner which we are defining. We strongly recommend reading the
relevant class documentation to understand its arguments (see e.g. the
<a href="https://mlr3.mlr-org.com/reference/Learner.html" class="external-link">learner
documentation</a>). These include:</p>
<ul>
<li>
<code>id</code>: The ID of the new learner.</li>
<li>
<code>packages</code>: The upstream package name(s) of the
implemented learner.</li>
<li>
<code>param_set</code>: A set of hyperparameters and their
descriptions provided as a <code><a href="https://paradox.mlr-org.com/reference/ParamSet.html" class="external-link">paradox::ParamSet</a></code>.</li>
<li>
<code>predict_types</code>: Set of predict types the learner
supports.</li>
<li>
<code>feature_types</code>: Set of feature types the learner is able
to handle.</li>
<li>
<code>properties</code>: Set of properties of the learner.</li>
<li>
<code>man</code>: The roxygen identifier of the learner. This is
used within the <code>$help()</code> method of the super class to open
the help page of the learner.</li>
<li>
<code>label</code>: The label of the learner. This should briefly
describe the learner (similar to the description’s title) and is for
example used for printing.</li>
</ul>
<p>To fill out some of this meta-information, one has to go through the
manual pages of the upstream packages. In order to know e.g. which
predict types or properties are available, reading the manual pages of
the corresponding superclass(es) is indispensable. Furthermore, it is a
good idea to look at already existing learner implementations for
inspiration.</p>
<div class="section level2">
<h2 id="defining-the-parameter-set-of-a-learner">Defining the Parameter Set of a Learner<a class="anchor" aria-label="anchor" href="#defining-the-parameter-set-of-a-learner"></a>
</h2>
<p>The parameter set of a learner is the set of hyperparameters used in
model training and predicting, this is given as a
<code><a href="https://paradox.mlr-org.com/reference/ParamSet.html" class="external-link">paradox::ParamSet</a></code>. The set consists of a list of
hyperparameters, where each has a specific class for the hyperparameter
type. For an explanation of parameters and the <code>ParamSet</code>
class we refer to the <a href="https://mlr3book.mlr-org.com/" class="external-link">mlr3book</a>, where we show how to
create parameter sets to define search spaces for hyperparameter tuning.
However, there are some aspects of parameters that are mostly relevant
when creating new <code>Learner</code>s, so we cover them here. These
are:</p>
<ul>
<li>
<strong>tags</strong> that organize the parameters, e.g. whether
they are used during training or prediction.</li>
<li>
<strong>default values</strong> which give information about the
value that is used by the upstream function when no value is set. Note
that this is not necessarily the default of the function signature but
what is used internally: e.g. the default of parameter <code>a</code>
for a function is <code>NULL</code>, but internally the value for
<code>a</code> is set to <code>1</code> it is left as <code>NULL</code>
by the caller.</li>
<li>
<strong>initial values</strong> are the initial <code>$values</code>
of the parameter set that are set during construction.</li>
<li>
<strong>custom checks</strong> which allow to specify custom
constraints for untyped parameters (<code>ParamUty</code>).</li>
</ul>
<p><strong>Tags</strong></p>
<p>Each parameter has one or more tags that determine in which method
they are used. I.e. parameters that are used during training must be
tagged with <code>"train"</code> and those that are used during
prediction with <code>"predict"</code>. In our case there are only
training parameters. Parameters with certain tags, can be retrieved by
calling the <code>$get_values()</code> method of a <code>ParamSet</code>
with the <code>tag</code> argument.</p>
<p>Furthermore, there are other tags that serve specific purposes:</p>
<ul>
<li>The tag <code>"threads"</code> should be used (if applicable) to tag
the parameter that determines the number of threads used for the
learner’s internal parallelization. Once a learner is constructed, this
parameter can be set using <code><a href="https://mlr3.mlr-org.com/reference/set_threads.html" class="external-link">set_threads()</a></code>.</li>
<li>The tag <code>"required"</code> should be used to tag parameters
that must be provided for the algorithm to be executable.</li>
</ul>
<p><strong>Default Values</strong></p>
<p>The default values of each parameter indicate which value the
upstream function (in this case <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code>) uses if no
parameter is specified. These have to be retrieved from the package’s
documentation. If parameters have no default, they have to be tagged
with the <code>"required"</code> tag. For such parameters, we
recommended setting the parameter to a value in the initialize method,
so that the learner can be executed after creation. Note that setting a
parameter value in the <code>$initialize()</code> method does not change
the parameter’s default value (as the default denotes what happens when
no value is set).</p>
<p>Parameters expect the default values to be of their respective type,
e.g. the default of <code>ParamInt</code> must be an integer. Some
packages have R expressions as default values which cannot be properly
expressed in <code>paradox</code>. In such cases, a practical compromise
is to not specify any default value when calling
<code><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_int()</a></code>.</p>
<p><strong>Initial Values</strong></p>
<p>In some cases you want to change the parameter values during
initialization. You can do this by changing the
<code>param_set$values</code> during the learner’s construction. You can
see we have done this for <code>regr.rpart_simple</code> where the
default for <code>xval</code> is changed to <code>0</code>. Note however
that we still annotate the default of the <code>xval</code> parameter as
10. It is recommended to initialize parameter values for good reasons
and document this properly when doing so. When contributing a learner to
<code>mlr3extralearners</code> this information should go into the
<em>Initial parameter values</em> section.</p>
<p><strong>Custom Checks</strong></p>
<p>In <code>paradox</code> only integers, numerics, factors, and
logicals have dedicated parameter types. For all other parameters, the
<code>ParamUty</code> class has to be used, which is constructable via
the <code><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_uty()</a></code> function. It has the argument
<code>custom_check</code>, which allows specifying custom constraints.
This function return <code>TRUE</code> if the input is valid and a
<code>character(1)</code> with the error message otherwise.</p>
<p><strong>Custom Parameters</strong></p>
<p>Sometimes you might want to add paramters that are not present in the
upstream function. One example is the <code>mtry.ratio</code> parameter
of <code>lrn("surv.ranger")</code>. Such parameters should usually not
have <code>default</code> values (because we are here not calling an
upstream function with a default behaviour) but instead have their value
initialized during construction and have the <code>"required"</code>
tag. This avoids having to deal with the case where this parameter has
no value set. When contributing a learner to
<code>mlr3extralearners</code> this information should go into the
<em>Custom parameters</em> section.</p>
</div>
<div class="section level2">
<h2 id="train-function">Train function<a class="anchor" aria-label="anchor" href="#train-function"></a>
</h2>
<p>The train function takes a <code>Task</code> as input and must return
a model, i.e. some <code>R</code> object that allows the learner to make
predictions. We want to translate the following call of
<code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code> into code that can be used inside the
<code>.train()</code> method.</p>
<p>First, we write something down that works completely without
<code>mlr3</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="va">mtcars</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span>, xval <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>We need to pass the formula notation <code>mpg ~ .</code>, the data
and the hyperparameters. To get the hyperparameters, we call
<code>self$param_set$get_values(tag = "train")</code> and thereby query
all parameters that are using during <code>"train"</code>. Then, the
dataset is extracted from the <code>Task</code>. Because the learner has
the property <code>"weights"</code>, we insert the weights of the task
if there are any. Then we obtain the formula from the task using
<code>task$formula()</code> and access the training data using
<code>task$data()</code>. Last, we call the upstream function
<code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code> with the data and pass all hyperparameters
via argument <code>.args</code> using the
<code><a href="https://mlr3misc.mlr-org.com/reference/invoke.html" class="external-link">mlr3misc::invoke()</a></code> function. The latter is simply an
optimized version of <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> that we use within the
<code>mlr3</code> ecosystem. The return value of this method will be
available as the <code>$model</code> slot of the trained learner.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.train</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">task</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pv</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"weights"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">task</span><span class="op">$</span><span class="va">properties</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pv</span><span class="op">$</span><span class="va">weights</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">weights</span><span class="op">$</span><span class="va">weight</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">formula</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">formula</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/invoke.html" class="external-link">invoke</a></span><span class="op">(</span></span>
<span>    <span class="fu">rpart</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span>,</span>
<span>    formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    .args <span class="op">=</span> <span class="va">pv</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>At this point, an explanation for the difference between the public
method <code>$train()</code> and the private method
<code>$.train()</code> is in order. The former essentially calls the
latter and additionally performs some checks and tasks that are the same
for every learner. The same holds for the predict method.</p>
</div>
<div class="section level2">
<h2 id="predict-function">Predict function<a class="anchor" aria-label="anchor" href="#predict-function"></a>
</h2>
<p>The internal method <code>$.predict()</code> also operates on a
<code>Task</code> as well as on the fitted model that has been created
by the <code>$train()</code> call previously and has been stored in
<code>self$model</code>. The return value must contain the required
information to produce a <code><a href="https://mlr3.mlr-org.com/reference/Prediction.html" class="external-link">mlr3::Prediction</a></code> object that is
returned when <code>$predict()</code> is called on a learner. We proceed
analogously to what we did in the previous section. We start with a
version without any <code>mlr3</code> objects and continue to replace
objects until we have reached the desired interface:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inputs:</span></span>
<span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">self</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu">rpart</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="fu">formula</span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">mtcars</span></span>
<span></span>
<span><span class="co"># response prediction</span></span>
<span><span class="va">response</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>Next, we transition from <code>data</code> to a <code>Task</code>
again and construct a list with the return type requested by the user.
This is stored in the <code>$predict_type</code> slot of a learner
class. Because the <code>regr.rpart_simple</code> learner we are
implementing has only one predict type, we do not have to take the value
of <code>self$predict_type</code> into account. For, e.g., regression
learners with predict types <code>"response"</code> and
<code>"se"</code> or classification learners with predict types
<code>"response"</code> and <code>"prob"</code>, the predict method must
return the prediction requested by the user.</p>
<p>The final <code>$.predict()</code> method is below, we could omit the
<code>pv</code> line as there are no parameters with the
<code>"predict"</code> tag but we keep it here to be consistent:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.predict</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">task</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pv</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"predict"</span><span class="op">)</span></span>
<span>  <span class="co"># ensure same column order in train and predict</span></span>
<span>  <span class="va">newdata</span> <span class="op">=</span> <span class="fu">mlr3extralearners</span><span class="fu">:::</span><span class="fu">ordered_features</span><span class="op">(</span><span class="va">task</span>, <span class="va">self</span><span class="op">)</span></span>
<span>  <span class="va">response</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/invoke.html" class="external-link">invoke</a></span><span class="op">(</span><span class="va">predict</span>, <span class="va">self</span><span class="op">$</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, .args <span class="op">=</span> <span class="va">pv</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Beware that you cannot rely on the column order of the data returned
by <code>task$data()</code> as the order of columns may be different
from the order of the columns during <code>$.train()</code>. The
<code>newdata</code> line ensures the ordering is the same by calling
the same order as in train!</p>
</div>
<div class="section level2">
<h2 id="optional-extractors">Optional Extractors<a class="anchor" aria-label="anchor" href="#optional-extractors"></a>
</h2>
<p>Specific learner implementations are free to implement additional
getters to ease the access of certain parts of the model in the
inherited subclasses. Some of these methods are standardized in
<code>mlr3</code>, c.f. the <code>Learner</code> documentation. If it is
one of the standardized extractors, some custom code might have to be
written for the return value to comply with the <code>mlr3</code>
standards (see the <code>Learner</code> documentation). Because we
specified earlier that the learner has the property
<code>"importance"</code>, we implement the public
<code>$importance()</code> method. They access the <code>$model</code>
slot of a learner after training and return one of its fields. Because
the <code>$importance()</code> method is standardized, it must return
the importance scores as a sorted numeric vector, the names being the
features.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">importance</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/printf.html" class="external-link">stopf</a></span><span class="op">(</span><span class="st">"No model stored"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># importance is only present if there is at least on split</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">variable.importance</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">importance</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">importance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">variable.importance</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">importance</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="testing-the-learner">Testing the learner<a class="anchor" aria-label="anchor" href="#testing-the-learner"></a>
</h2>
<p>Once your learner is created, you should write tests to verify its
correctness. While you should also do this when implementing a learner
only for your own use, this is absolutely required when you want to
contribute a new learner to <code>mlr3extralearners</code>. Besides
manual tests, the <code>mlr3</code> package also provides automatic
tests to check that a learner satisfies some basic sanity checks and
that it implements all the available parameters of the upstream
function. The manual page for these functions can be accessed via
<code><a href="https://mlr3.mlr-org.com/reference/mlr_test_helpers.html" class="external-link">?mlr_test_helpers</a></code>.</p>
<p>For a bare-bone check you can just try to run a simple
<code>$train()</code> call.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">=</span> <span class="va">LearnerRegrRpartSimple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="va">learner</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## regr.mse </span></span>
<span><span class="co">## 9.127693</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learner</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       cyl      disp        hp        wt      qsec        vs      carb      gear </span></span>
<span><span class="co">## 724.18935 721.08062 702.29023 573.72817 442.05737 395.01237  31.36333  15.68167</span></span></code></pre>
<p>If it runs without erroring, that’s a very good start!</p>
<div class="section level3">
<h3 id="autotest">Autotest<a class="anchor" aria-label="anchor" href="#autotest"></a>
</h3>
<p>To ensure that your learner is able to handle all kinds of different
properties and feature types, we have written an “autotest” that checks
the learner for different combinations of such. In addition to the
autotest we also check some other learner properties using
<code>expect_learner()</code>. See section <em>run_autotest</em> and
<em>expect_learner</em> of <code><a href="https://mlr3.mlr-org.com/reference/mlr_test_helpers.html" class="external-link">?mlr_test_helpers</a></code> for an
explanation. Because these functions are not in the <code>mlr3</code>
namespace, we have to source them from the <code>./testthat</code>
subfolder of the installed <code>mlr3</code> package Note that when
implementing survival learners, you must also source these help files
from the <code>mlr3proba</code> package.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testthat"</span>, package <span class="op">=</span> <span class="st">"mlr3"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"^helper.*\\.[rR]"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">source</span><span class="op">)</span></span>
<span><span class="co"># mlr3proba</span></span>
<span><span class="co"># lapply(list.files(system.file("testthat", package = "mlr3proba"), pattern = "^helper.*\\.[rR]", full.names = TRUE), source)</span></span></code></pre></div>
<p>We now perform the autotest. By setting
<code>expect_learner(..., check_man = FALSE)</code>, we disable a test
that verifies that the correct manual page exists, which is only
relevant when adding the learner to <code>mlr3extralearners</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"autotest"</span>, <span class="op">{</span></span>
<span>  <span class="va">learner</span> <span class="op">=</span> <span class="va">LearnerRegrRpartSimple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># basic learner properties</span></span>
<span>  <span class="fu">expect_learner</span><span class="op">(</span><span class="va">learner</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># you can skip tests using the `exclude` argument</span></span>
<span>  <span class="va">result</span> <span class="op">=</span> <span class="fu">run_autotest</span><span class="op">(</span><span class="va">learner</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="va">result</span>, info <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">error</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Test passed</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="checking-parameters">Checking Parameters<a class="anchor" aria-label="anchor" href="#checking-parameters"></a>
</h3>
<p>Some learners have a high number of parameters and it is easy to miss
out on some during the creation of a new learner or misspell a
parameter. Therefore we have written a “Parameter Check” that can be
used to check that the parameters are correctly implemented. See section
<em>run_paramtest</em> of <code><a href="https://mlr3.mlr-org.com/reference/mlr_test_helpers.html" class="external-link">?mlr_test_helpers</a></code> for an
explanation. This “Parameter Check” compares the parameters of the
<code>mlr3</code> ParamSet against all arguments available in the
upstream function that is called during <code>$train()</code> and
<code>$predict()</code>. When the <code>$.train()</code> method either
calls multiple functions, or, e.g., the <code>...</code> arguments are
passed further to a control function (as in the case here), a list of
functions can be passed to the parameter test.</p>
<p>The test comes with an <code>exclude</code> argument that should be
used to <em>exclude and explain</em> why certain arguments of the
upstream function are not within the <code>ParamSet</code> of the
learner. This will likely be required for all learners as common
arguments like <code>x</code>, <code>target</code> or <code>data</code>
are handled by the <code>mlr3</code> interface and are therefore not
included within the ParamSet.</p>
<p>However, there might be more parameters that need to be excluded, for
example:</p>
<ul>
<li>Type dependent parameters, i.e. parameters that only apply for
classification or regression learners.</li>
<li>Parameters that are actually deprecated by the upstream package and
which were therefore not included in the <code>mlr3</code>
ParamSet.</li>
</ul>
<p>All excluded parameters should have a comment justifying their
exclusion.</p>
<p>In our example, the final paramtest script looks like:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"paramtest"</span>, <span class="op">{</span></span>
<span>  <span class="va">learner</span> <span class="op">=</span> <span class="va">LearnerRegrRpartSimple</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">exclude</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"formula"</span>, <span class="st">"data"</span>, <span class="st">"weights"</span>, <span class="st">"subset"</span>, <span class="st">"na.action"</span>, <span class="st">"method"</span>, <span class="st">"model"</span>,</span>
<span>    <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"parms"</span>, <span class="st">"control"</span>, <span class="st">"cost"</span>, <span class="st">"keep_model"</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">=</span> <span class="fu">run_paramtest</span><span class="op">(</span><span class="va">learner</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">rpart</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span>, <span class="fu">rpart</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html" class="external-link">rpart.control</a></span><span class="op">)</span>, <span class="va">exclude</span>, tag <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="va">result</span>, info <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">error</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">exclude</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"object"</span>, <span class="co"># handled internally</span></span>
<span>    <span class="st">"newdata"</span>, <span class="co"># handled internally</span></span>
<span>    <span class="st">"type"</span>, <span class="co"># handled internally</span></span>
<span>    <span class="st">"na.action"</span>, <span class="co"># handled internally</span></span>
<span>    <span class="st">"model"</span> <span class="co"># not implemented</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">=</span> <span class="fu">run_paramtest</span><span class="op">(</span><span class="va">learner</span>, <span class="fu">rpart</span><span class="fu">:::</span><span class="va"><a href="https://rdrr.io/pkg/rpart/man/predict.rpart.html" class="external-link">predict.rpart</a></span>, <span class="va">exclude</span>, tag <span class="op">=</span> <span class="st">"predict"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="va">result</span>, info <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">error</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Test passed</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="contributing-to-mlr3extralearners">Contributing to mlr3extralearners<a class="anchor" aria-label="anchor" href="#contributing-to-mlr3extralearners"></a>
</h2>
<p>When adding a <code>Learner</code> to <code>mlr3extralearners</code>
there are some additional requirements that have to be satisfied:</p>
<ul>
<li>Adding the line
<code>.extralrns_dict$add("&lt;learner-id&gt;", function() &lt;LearnerName&gt;$new())</code>
to the bottom of the learner file to add the learner to the learners
<code>Dictionary</code>.</li>
<li>Add the learner dependencies to <em>Suggests</em> (and not e.g. to
<em>Imports</em>) in the DESCRIPTION file.</li>
<li>The learner must be properly documented. When using
<code><a href="../reference/create_learner.html">mlr3extralearners::create_learner()</a></code> this is automatically
generated. Otherwise you can use and adapt the documentation of an
already implemented learner.</li>
<li>Conforming to the <code>mlr3</code> <a href="https://github.com/mlr-org/mlr3/wiki/Style-Guide" class="external-link">style
guide</a>.</li>
<li>The tests must pass in the CI (also check the CodeFactor
results).</li>
<li>Update the <code>NEWS.md</code> file and describe that you added the
learner.</li>
<li>Add yourself as a contributor</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Raphael Sonabend, <a href="https://pat-s.me" class="external-link">Patrick Schratz</a>, Sebastian Fischer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
